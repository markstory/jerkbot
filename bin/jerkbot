#!/usr/bin/env node

var optparse = require('optparse'),
	sys = require('sys'),
	path = require('path');

var switches = [
	['-h', '--help', 'Show the help'],
	['-c', '--config', 'Choose a config file to run jerkbot with.']
];

// Setup the option parser.
var parser = new optparse.OptionParser(switches);
parser.banner = 'jerkbot [options] [arguments]';

parser.on('help', function () {
	sys.puts(parser);
	process.exit(0);
});


var configFile = path.join(process.cwd(), 'jerk.js')
parser.on('config', function (value) {
	configFile = value;
});

var args = parser.parse(process.argv.slice(2));

require.paths.unshift(path.join(__dirname, '..', 'lib'));
var jerkbot = require('jerkbot');

// Get the config file and start the server.
var configuration = jerkbot.loadConfig(configFile);
var server = jerkbot.createServer(configuration);

server.listen(configuration.port, configuration.host, function () {
	sys.puts('Jerkbot started ' + configuration.host + ':' + configuration.port);
});